<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="task_eva_add_component" model="ir.ui.view">
            <field name="name">task.eva.add.component</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_form2"/>
            <field name="arch" type="xml">
                <xpath expr="//page[@name='description_page']" position="before">
                    <field name="porder_state" invisible="1"/>
                    <page string="Components" name="components">
                            <field name="move_raw_ids">
                                <tree default_order="is_done, manual_consumption desc, sequence" editable="bottom">
                                    <field name="product_id" force_save="1" required="1" context="{'default_detailed_type': 'product'}" attrs="{'readonly': ['|', '|', ('move_lines_count', '&gt;', 0), ('state', '=', 'cancel'), '&amp;', ('state', '!=', 'draft'), ('additional', '=', False) ]}"/>
                                    <field name="location_id" string="From" readonly="1" force_save="1" groups="stock.group_stock_multi_locations" optional="show"/>
                                    <!-- test_immediate_validate_uom_2, test_product_produce_different_uom -->
                                    <field name="product_uom" invisible="1"/>
                                    <field name="propagate_cancel" invisible="1"/>
                                    <field name="price_unit" invisible="1"/>
                                    <field name="company_id" invisible="1"/>
                                    <field name="product_uom_category_id" invisible="1"/>
                                    <field name="name" invisible="1"/>
                                    <field name="allowed_operation_ids" invisible="1"/>
                                    <field name="unit_factor" invisible="1"/>
                                    <field name="date_deadline" invisible="1" force_save="1"/>
                                    <field name="date" invisible="1"/>
                                    <field name="additional" invisible="1"/>
                                    <field name="picking_type_id" invisible="1"/>
                                    <field name="has_tracking" invisible="1"/>
                                    <field name="operation_id" invisible="1"/>
                                    <field name="is_done" invisible="1"/>
                                    <field name="bom_line_id" invisible="1"/>
                                    <field name="sequence" invisible="1"/>
                                    <field name="warehouse_id" invisible="1"/>
                                    <field name="is_locked" invisible="1"/>
                                    <field name="move_lines_count" invisible="1"/>

                                    <field name="state" invisible="1" force_save="1"/>
                                    <field name="should_consume_qty" invisible="1"/>
                                    <field name="product_uom_qty" widget="mrp_should_consume" force_save="1" string="To Consume" width="1" attrs="{'readonly': ['|', ('parent.porder_state', '!=', 'draft'), ('parent.porder_state', 'not in', ('confirmed', 'progress', 'to_close'))]}"/>
                                    <field name="product_uom" attrs="{'readonly': [('state', '!=', 'draft'), ('id', '!=', False)]}" options="{'no_open': True, 'no_create': True}" groups="uom.group_uom"/>
                                    <field name="product_type" invisible="1"/>
                                    <field name="product_qty" invisible="1" readonly="1"/>
                                    <field name="reserved_availability" invisible="1"/>
                                    <field name="forecast_expected_date" invisible="1"/>
                                    <!-- Button are used in state draft to doesn't have the name of the column "Reserved"-->
                                    <button type="object" name="action_product_forecast_report" title="Forecast Report" icon="fa-area-chart" attrs="{'column_invisible': [('parent.porder_state', '!=', 'draft')], 'invisible': [('forecast_availability', '&lt;', 0)]}"/>
                                    <button type="object" name="action_product_forecast_report" title="Forecast Report" icon="fa-area-chart text-danger" attrs="{'column_invisible': [('parent.porder_state', '!=', 'draft')], 'invisible': [('forecast_availability', '&gt;=', 0)]}"/>
                                    <field name="forecast_availability" string="Reserved" attrs="{'column_invisible': [('parent.porder_state', 'in', ('draft', 'done'))]}" widget="forecast_widget"/>
                                    <field name="quantity_done" string="Consumed" class="o_manual_consumption"
                                        decoration-bf="not manual_consumption"
                                        decoration-success="not is_done and (quantity_done - should_consume_qty == 0)"
                                        decoration-warning="not is_done and (quantity_done - should_consume_qty &gt; 0.0001)"
                                           attrs="{'column_invisible': [('parent.porder_state', '=', 'draft')], 'readonly': [('has_tracking', '!=','none')]}"
                                        force_save="1"/>
                                    <field name="manual_consumption" invisible="1" force_save="1"/>
                                    <field name="show_details_visible" invisible="1"/>
                                    <field name="lot_ids" widget="many2many_tags"
                                        optional="hide"
                                        readonly="1"
                                        string="Lot/Serial Numbers"
                                        help="Displays the consumed Lot/Serial Numbers."
                                        groups="stock.group_production_lot"
                                        context="{'default_company_id': company_id, 'default_product_id': product_id}"
                                        domain="[('product_id','=',product_id)]"
                                           attrs="{'invisible': ['|', ('show_details_visible', '=', False), ('parent.porder_state', '=', 'draft')],}"
                                    />
                                    <field name="group_id" invisible="1"/>
                                    <button name="action_show_details" type="object" title="Show Details" icon="fa-list" context="{'default_product_uom_qty': 0}" attrs="{'invisible': ['|', ('show_details_visible', '=', False), ('has_tracking', '=','none')]}" options="{&quot;warn&quot;: true}"/>
                                    <button class="o_optional_button btn btn-light" name="action_show_details" type="object" title="Show Details" icon="fa-list" context="{'default_product_uom_qty': 0}" attrs="{'invisible': ['|', ('has_tracking', '!=','none'), ('show_details_visible', '=', False)]}" options="{&quot;warn&quot;: true}"/>
                                </tree>
                            </field>
                        </page>
                </xpath>

                <xpath expr="//field[@name='user_ids']" position="after">
                    <field name="mrp_order_id" readonly="1" attrs="{ 'invisible': [('mrp_order_id', '=', False)]}"/>
                </xpath>
            </field>
    </record>
</odoo>